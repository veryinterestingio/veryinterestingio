	<ul class="replies">
		<li class="reply">
			<a class="author" href="https://www.reddit.com/user/YaztromoX" target="_blank">YaztromoX</a>
			<div class="markdown"><p>Routers don't know anything about HTTP in particular, as they run on a much lower network layer.  Routing primarily works at the <em>internet layer</em>, whereas HTTP works at the <em>application layer</em>.  At the <em>internet layer</em> devices aren't concerned about <em>what</em> is being passed around, but instead just ensuring that the packets of data get delivered to their next <em>hop</em> in the transport chain.</p>
<p>From when you type in a URL and press enter, a variety of steps are then taken by your machine and your local router:</p>
<ol>
<li>Assuming you typed an address (i.e.: <a href="http://www.reddit.com" target="_blank"><a href="http://www.reddit.com" target="_blank">http://www.reddit.com</a></a>) into your browser, the computer will need to translate this to an address.  This is accomplished by a <em>Domain Name Server</em> (DNS).  Your local computer will send a request to one of its configured Domain Name Servers (usually via the <em>User Datagram Protocol</em> (UDP)), which will return an address for that name (if available, or a &quot;not found&quot; message if the specified system is unknown)^0.</li>
<li>Once your system has the address of the destination, it will use an internally-held <em>routing table</em> to determine where to send the relevant packets (for TCP, this would start with a SYN packet).  If the destination is local (i.e: on the same network or subnetwork), your computer might be able to establish the connection directly.  If not, it will likely delegate to the <em>default route</em>, which is typically your local router.  For the rest of this discussion, I'll assume the destination is remote, and needs to go through your router (as that scenario moe closely matches your question).  </li>
<li>Your router also has its own <em>routing table</em>.  For home routers, this may just contain a single <em>default route</em> entry, pointing to your ISPs local router.  The packet is then forwarded to your ISPs router.</li>
<li>Your ISPs router (and each subsequent router in the chain) does the same task:  it receives the packet, and checks the destination address against its <em>routing table</em> to see which router should handle the request next.  The packet is then forwarded to that router.</li>
<li>Eventually, some router receives your packet and checks its routing table and says to itself <em>I know this machine -- it's directly attached to me</em>.  At this point, your packet is delivered to the destination.</li>
</ol>
<p>This same dance is also done in reverse (should the destination wish to reply to your machine).</p>
<p>As for your second question, port mapping isn't really a core part of the Internet itself, and only exists on local networks due to the evil hack known as <em>Native Address Translation</em> (NAT).  Your computer doesn't really know much about port mapping; this is primarily the domain of a NAT-based router.  However, you do run into the situation you describe where you might have some random, changing port number that you want to be able to map, and for that we have some additional protocols to help.</p>
<p>Those protocols are <em>Universal Plug and Play</em> (UPnP)^1, <em>Native Address Translation Port Mapping Protocol</em> (NAT-PMP)^2, and <em>Port Control Protocol</em> (PCP)^3.  These protocols permit a system to request the forwarding of a specific local port to some port mapped on the internet-facing side of the NAT router.  Once mapped, if an incoming request is made on the internet-facing side of the router for a mapped port, the router will lookup the NAT destination address for the packet, change the destination address in the packet^4 to match that of the port mapping, and then forward the packet to the destination.  These protocols are well known and well designed, but ultimately are hacks to get around the major hack that is NAT.</p>
<p>We're slowly moving to a point where IPv6 is more prevalent, at which point NAT and port mapping should disappear.  Instead of mapping ports, you'll be able to simply specify at your router which ports are permitted to be forwarded.  Every host behind your router will be able to respond to every port (so unlike with NAT, you can have multiple machines to respond to external requests on port 80), and your router won't have to deal with address translation, and instead can simply apply firewall rules.  Then we'll be able to get rid of STUN, UPnP, NAT-PMP, PCP, and a pile of other protocols that exist to try to work around NAT.  And the Internet will be a vastly nicer place for it.</p>
<p>HTH!</p>
<hr />
<p>^0 -- there are some other ways in which your local machine may attempt to determine the address for a given hostname.  DNS is the most common on the open Internet, but inside a private network you could also have Bonjour/ZeroConf/dns-sd running, which allows hosts at advertise on their addresses and available services to other systems on your local subnet.<br />
^1 -- a bad name IMO, as <em>plug &amp; play</em> was originally coined to refer to self-configuring system boards and peripherals.  The UPnP protocol doesn't have anything to do with configuring <em>devices</em>, and you're usually not physically plugging anything in when you use it -- it's about mapping ports, so the name doesn't really fit with what it does.  But it seems we're stuck with it for now.<br />
^2 -- Now there's a name that actually describes what the protocol does! :).<br />
^3 -- Good name, <a href="https://en.wikipedia.org/wiki/Phencyclidine" target="_blank">bad acronym</a>.<br />
^4 -- this is the <em>translation</em> part of &quot;NAT&quot;.</p></div>		</li>
						<li class="reply">
			<a class="author" href="https://www.reddit.com/user/UniQMG" target="_blank">UniQMG</a>
			<div class="markdown"><p>To answer your second question, DNS, the service which translates domain names like <code>something.random</code> into an IP address, has no concept of ports as it operates on a lower level of networking. You can map <code>something.random</code> to your local computer, but you can't specify the port that way.</p>
<p>You can map <code>something.random</code> to your local machine using your hosts file, which acts as a local hardcoded DNS (<code>C:\Windows\System32\drivers\etc\HOSTS</code> on windows, <code>/etc/hosts</code> on linux). This even works for real domains, so you could override <code>google.com</code> to map to your local machine.</p>
<p>Using a reverse proxy such as nginx, you can forward HTTP requests (based on their host header) to specific ports, but this only applies to HTTP. This works because your browser sends the hostname as part of the request itself, so the reverse proxy knows where to forward it.</p>
<p>The HOSTS file only applies to your local machine. If you wanted other machines to be able to connect to it, you can either buy the domain and configure DNS through your domain provider, or run your own DNS server and then configure those machines to use that DNS server.</p></div>		</li>
						<li class="reply">
			<a class="author" href="https://www.reddit.com/user/RealDealKeel" target="_blank">RealDealKeel</a>
			<div class="markdown"><p>I can answer your first question to some degree. </p>
<p>Since we are talking about http specifically, let’s discuss the client/server model. You would typically have a server which hosts a webpage, and a client which would be requesting the webpage (through a web browser). </p>
<p>The server is going to be configured with an IP address and also be configured to accept http requests on a specific port # which by default is port 80. The router (or routers) in between the client and the server are less concerned with the type of traffic moving through them, and more concerned with the destination of that traffic. When the client sends an http request to the server, it will use the servers IP address as it’s destination IP for that traffic. This can be learned through various methods, but one popular method is a protocol called DNS. Once the traffic hits the router, it will check its routing table to see if it has a next hop configured for that destination IP. Traffic is forwarded via the next hop IP until the traffic reaches its destination. </p>
<p>Hopefully this helps.</p></div>		</li>
					</ul>
	